    <script>
        // Game State
        let gameState = {
            gameStarted: false,
            currentInning: 1,
            isTopInning: true,
            homeScore: 0,
            awayScore: 0,
            currentOuts: 0,
            // Pitch count tracking
            balls: 0,
            strikes: 0,
            // Batting order tracking
            homeBatter: 1,
            awayBatter: 1,
            homeLineupSize: 9,
            awayLineupSize: 9,
            homeTeamName: '',
            awayTeamName: '',
            runners: {
                first: null,
                second: null,
                third: null
            },
            manager1Submission: null,
            manager2Submission: null,
            totalPlays: 0,
            // Earned run tracking
            inningErrorOccurred: false,
            errorWith2Outs: false,
            // Player Statistics
            playerStats: {
                home: {},
                away: {}
            },
            pitcherStats: {
                home: {
                    ip: 0,      // innings pitched (in thirds)
                    h: 0,       // hits allowed
                    r: 0,       // runs allowed
                    er: 0,      // earned runs allowed
                    bb: 0,      // walks allowed
                    k: 0        // strikeouts
                },
                away: {
                    ip: 0,
                    h: 0,
                    r: 0,
                    er: 0,
                    bb: 0,
                    k: 0
                }
            }
        };

        function getCurrentBatter() {
            return gameState.isTopInning ? gameState.awayBatter : gameState.homeBatter;
        }

        function getCurrentTeamName() {
            return gameState.isTopInning ? gameState.awayTeamName : gameState.homeTeamName;
        }

        function getCurrentLineupSize() {
            return gameState.isTopInning ? gameState.awayLineupSize : gameState.homeLineupSize;
        }

        function advanceBatter() {
            if (gameState.isTopInning) {
                gameState.awayBatter++;
                if (gameState.awayBatter > gameState.awayLineupSize) {
                    gameState.awayBatter = 1;
                }
            } else {
                gameState.homeBatter++;
                if (gameState.homeBatter > gameState.homeLineupSize) {
                    gameState.homeBatter = 1;
                }
            }
        }

        function initializePlayerStats() {
            // Initialize batting stats for both teams
            for (let i = 1; i <= gameState.awayLineupSize; i++) {
                gameState.playerStats.away[i] = {
                    ab: 0,      // at bats
                    r: 0,       // runs
                    h: 0,       // hits
                    rbi: 0,     // RBIs
                    bb: 0,      // walks
                    k: 0,       // strikeouts
                    avg: 0.000  // batting average
                };
            }
            
            for (let i = 1; i <= gameState.homeLineupSize; i++) {
                gameState.playerStats.home[i] = {
                    ab: 0,
                    r: 0,
                    h: 0,
                    rbi: 0,
                    bb: 0,
                    k: 0,
                    avg: 0.000
                };
            }
        }

        function updatePlayerStats(batterNum, isAway, result, runsScored, rbiCount, earnedRuns) {
            const team = isAway ? 'away' : 'home';
            const pitcher = isAway ? 'home' : 'away'; // opposing pitcher
            const player = gameState.playerStats[team][batterNum];
            
            // Update batter stats
            if (isAtBat(result)) {
                player.ab++;
            }
            
            if (isHit(result)) {
                player.h++;
            }
            
            if (isWalk(result)) {
                player.bb++;
                gameState.pitcherStats[pitcher].bb++;
            }
            
            if (isStrikeout(result)) {
                player.k++;
                gameState.pitcherStats[pitcher].k++;
            }
            
            player.rbi += rbiCount;
            
            // Update batting average
            if (player.ab > 0) {
                player.avg = (player.h / player.ab).toFixed(3);
            }
            
            // Update pitcher stats
            if (isHit(result)) {
                gameState.pitcherStats[pitcher].h++;
            }
            
            // All runs count toward total runs allowed
            gameState.pitcherStats[pitcher].r += runsScored;
            
            // Only earned runs count toward ERA
            gameState.pitcherStats[pitcher].er += earnedRuns;
        }

        function calculateEarnedRuns(result, runsScored) {
            // MLB Rule: If an error occurred with 2 outs, all subsequent runs in the inning are unearned
            if (gameState.errorWith2Outs) {
                return 0; // All runs unearned after error with 2 outs
            }
            
            // Check if current play is an error
            const isError = result.startsWith('E') || result.includes('+E');
            
            // Check if current play is a passed ball (catcher's fault, not pitcher's)
            const isPassedBall = result === 'PB' || result === 'KPB';
            
            // Runs that score due to errors or passed balls are unearned
            if (isError || isPassedBall) {
                return 0; // No earned runs on errors or passed balls
            }
            
            // Wild pitches are earned runs (pitcher's fault)
            // All other runs (hits, walks, etc.) are earned
            return runsScored;
        }

        function checkForErrorWith2Outs(result) {
            // Check if this play is an error and there are currently 2 outs
            const isError = result.startsWith('E') || result.includes('+E');
            
            if (isError && gameState.currentOuts === 2) {
                gameState.errorWith2Outs = true;
                gameState.inningErrorOccurred = true;
                return true;
            }
            
            // Also check for errors with fewer than 2 outs
            if (isError) {
                gameState.inningErrorOccurred = true;
            }
            
            return false;
        }

        function resetInningErrorTracking() {
            gameState.inningErrorOccurred = false;
            gameState.errorWith2Outs = false;
        }

        function isAtBat(result) {
            // Count as at-bat (excludes walks, HBP, sacrifices)
            const nonAtBats = ['BB', 'IBB', 'HBP', 'CI', 'SAC', 'SF', 'SF7', 'SF8', 'SF9'];
            return !nonAtBats.includes(result) && !result.startsWith('SB') && !result.startsWith('CS') && !result.startsWith('PO') && result !== 'WP' && result !== 'PB' && result !== 'BALK';
        }

        function isHit(result) {
            return ['1B', '2B', '3B', 'HR', '1B+E', '2B+E'].includes(result);
        }

        function isWalk(result) {
            return ['BB', 'IBB', 'HBP', 'CI'].includes(result);
        }

        function isStrikeout(result) {
            return ['K', 'KC', 'KPB', 'KWP'].includes(result);
        }

        function showBoxScoreTab(tab) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Hide all content
            document.querySelectorAll('.box-score-content').forEach(content => content.classList.add('hidden'));
            
            // Show selected tab
            if (tab === 'batting') {
                document.querySelector('.tab-btn').classList.add('active');
                document.getElementById('battingStats').classList.remove('hidden');
            } else if (tab === 'pitching') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('pitchingStats').classList.remove('hidden');
            }
        }

        function addBall() {
            gameState.balls++;
            updatePitchCount();
            
            // Check for walk (4 balls)
            if (gameState.balls >= 4) {
                addToGameLog(`Ball 4 - Automatic Walk (BB)`, 'Pitch');
                
                // Auto-submit BB for both managers
                const walkSubmission = {
                    result: 'BB',
                    timestamp: new Date().toLocaleTimeString()
                };
                
                gameState.manager1Submission = walkSubmission;
                gameState.manager2Submission = walkSubmission;
                
                // Process the walk
                recordPlay(walkSubmission);
            } else {
                addToGameLog(`Ball ${gameState.balls}`, 'Pitch');
            }
        }

        function addStrike() {
            gameState.strikes++;
            updatePitchCount();
            
            // Check for strikeout (3 strikes)
            if (gameState.strikes >= 3) {
                addToGameLog(`Strike 3 - Automatic Strikeout (K)`, 'Pitch');
                
                // Auto-submit K for both managers
                const strikeoutSubmission = {
                    result: 'K',
                    timestamp: new Date().toLocaleTimeString()
                };
                
                gameState.manager1Submission = strikeoutSubmission;
                gameState.manager2Submission = strikeoutSubmission;
                
                // Process the strikeout
                recordPlay(strikeoutSubmission);
            } else {
                addToGameLog(`Strike ${gameState.strikes}`, 'Pitch');
            }
        }

        function resetCount() {
            gameState.balls = 0;
            gameState.strikes = 0;
            updatePitchCount();
            addToGameLog('Count reset to 0-0', 'Pitch');
        }

        function updatePitchCount() {
            document.getElementById('ballCount').textContent = gameState.balls;
            document.getElementById('strikeCount').textContent = gameState.strikes;
        }

        function resetPitchCount() {
            gameState.balls = 0;
            gameState.strikes = 0;
            updatePitchCount();
        }

        function manageRunner(base) {
            const runner = gameState.runners[base];
            const baseNames = { first: '1st Base', second: '2nd Base', third: '3rd Base' };
            
            if (!runner) {
                // No runner on this base
                showAddRunnerModal(base, baseNames[base]);
            } else {
                // Runner exists - show management options
                showManageRunnerModal(base, baseNames[base], runner);
            }
        }

        function showAddRunnerModal(base, baseName) {
            const modal = document.getElementById('runnerModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `Add Runner to ${baseName}`;
            content.innerHTML = `
                <p>Select batter number to place on ${baseName}:</p>
                <div style="margin: 15px 0;">
                    ${generateBatterOptions()}
                </div>
                <button class="btn btn-success" onclick="addRunner('${base}')">Add Runner</button>
            `;
            
            modal.style.display = 'block';
        }

        function showManageRunnerModal(base, baseName, runner) {
            const modal = document.getElementById('runnerModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `Manage Runner #${runner} on ${baseName}`;
            content.innerHTML = `
                <p><strong>Current Runner:</strong> Batter #${runner}</p>
                <div style="margin: 20px 0;">
                    <h4>Runner Actions:</h4>
                    ${generateRunnerActions(base)}
                </div>
                <div style="margin: 20px 0;">
                    <h4>Change Runner:</h4>
                    ${generateBatterOptions()}
                    <br><button class="btn" onclick="changeRunner('${base}')" style="margin-top: 10px;">Change Runner</button>
                </div>
                <button class="btn" onclick="removeRunner('${base}')" style="background: #dc3545;">Remove Runner</button>
            `;
            
            modal.style.display = 'block';
        }

        function generateBatterOptions() {
            const currentTeam = gameState.isTopInning ? 'away' : 'home';
            const lineupSize = gameState.isTopInning ? gameState.awayLineupSize : gameState.homeLineupSize;
            
            let options = '<select id="selectedBatter">';
            for (let i = 1; i <= lineupSize; i++) {
                options += `<option value="${i}">Batter #${i}</option>`;
            }
            options += '</select>';
            return options;
        }

        function generateRunnerActions(base) {
            let actions = '';
            
            if (base === 'first') {
                actions += `
                    <button class="btn" onclick="performRunnerAction('${base}', 'SB2')" style="margin: 5px;">Steal 2nd</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'CS2')" style="margin: 5px;">Caught Stealing 2nd</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'PO1')" style="margin: 5px;">Picked Off 1st</button>
                `;
            } else if (base === 'second') {
                actions += `
                    <button class="btn" onclick="performRunnerAction('${base}', 'SB3')" style="margin: 5px;">Steal 3rd</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'CS3')" style="margin: 5px;">Caught Stealing 3rd</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'PO2')" style="margin: 5px;">Picked Off 2nd</button>
                `;
            } else if (base === 'third') {
                actions += `
                    <button class="btn" onclick="performRunnerAction('${base}', 'SBH')" style="margin: 5px;">Steal Home</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'CSH')" style="margin: 5px;">Caught Stealing Home</button>
                    <button class="btn" onclick="performRunnerAction('${base}', 'PO3')" style="margin: 5px;">Picked Off 3rd</button>
                `;
            }
            
            actions += `<br><button class="btn" onclick="performRunnerAction('${base}', 'WP')" style="margin: 5px;">Wild Pitch Advance</button>`;
            actions += `<button class="btn" onclick="performRunnerAction('${base}', 'PB')" style="margin: 5px;">Passed Ball Advance</button>`;
            actions += `<button class="btn" onclick="performRunnerAction('${base}', 'BALK')" style="margin: 5px;">Balk Advance</button>`;
            
            return actions;
        }

        function addRunner(base) {
            const selectedBatter = document.getElementById('selectedBatter').value;
            gameState.runners[base] = parseInt(selectedBatter);
            updateRunnerDisplay();
            closeRunnerModal();
            addToGameLog(`Runner #${selectedBatter} manually placed on ${base} base`, 'Manual');
        }

        function changeRunner(base) {
            const selectedBatter = document.getElementById('selectedBatter').value;
            const oldRunner = gameState.runners[base];
            gameState.runners[base] = parseInt(selectedBatter);
            updateRunnerDisplay();
            closeRunnerModal();
            addToGameLog(`Runner changed on ${base} base: #${oldRunner} → #${selectedBatter}`, 'Manual');
        }

        function removeRunner(base) {
            const runner = gameState.runners[base];
            gameState.runners[base] = null;
            updateRunnerDisplay();
            closeRunnerModal();
            addToGameLog(`Runner #${runner} removed from ${base} base`, 'Manual');
        }

        function performRunnerAction(base, action) {
            // Auto-submit the action for both managers
            const actionSubmission = {
                result: action,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState.manager1Submission = actionSubmission;
            gameState.manager2Submission = actionSubmission;
            
            closeRunnerModal();
            
            // Process the action
            recordPlay(actionSubmission);
        }

        function closeRunnerModal() {
            document.getElementById('runnerModal').style.display = 'none';
        }

        function updateBoxScore() {
            updateBattingStats();
            updatePitchingStats();
        }

        function updateBattingStats() {
            // Update away team batting
            const awayTable = document.getElementById('awayBattingStats');
            awayTable.innerHTML = '';
            
            for (let i = 1; i <= gameState.awayLineupSize; i++) {
                const stats = gameState.playerStats.away[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>Player ${i}</td>
                    <td>${stats.ab}</td>
                    <td>${stats.r}</td>
                    <td>${stats.h}</td>
                    <td>${stats.rbi}</td>
                    <td>${stats.bb}</td>
                    <td>${stats.k}</td>
                    <td>${stats.avg}</td>
                `;
                awayTable.appendChild(row);
            }
            
            // Update home team batting
            const homeTable = document.getElementById('homeBattingStats');
            homeTable.innerHTML = '';
            
            for (let i = 1; i <= gameState.homeLineupSize; i++) {
                const stats = gameState.playerStats.home[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>Player ${i}</td>
                    <td>${stats.ab}</td>
                    <td>${stats.r}</td>
                    <td>${stats.h}</td>
                    <td>${stats.rbi}</td>
                    <td>${stats.bb}</td>
                    <td>${stats.k}</td>
                    <td>${stats.avg}</td>
                `;
                homeTable.appendChild(row);
            }
        }

        function updatePitchingStats() {
            // Update away team pitching (they pitch when home team bats)
            const awayPitcher = gameState.pitcherStats.away;
            const awayIP = Math.floor(awayPitcher.ip / 3) + '.' + (awayPitcher.ip % 3);
            const awayERA = awayPitcher.ip > 0 ? ((awayPitcher.er * 27) / awayPitcher.ip).toFixed(2) : '0.00';
            
            document.getElementById('awayPitcherIP').textContent = awayIP;
            document.getElementById('awayPitcherH').textContent = awayPitcher.h;
            document.getElementById('awayPitcherR').textContent = awayPitcher.r;
            document.getElementById('awayPitcherER').textContent = awayPitcher.er;
            document.getElementById('awayPitcherBB').textContent = awayPitcher.bb;
            document.getElementById('awayPitcherK').textContent = awayPitcher.k;
            document.getElementById('awayPitcherERA').textContent = awayERA;
            
            // Update home team pitching (they pitch when away team bats)
            const homePitcher = gameState.pitcherStats.home;
            const homeIP = Math.floor(homePitcher.ip / 3) + '.' + (homePitcher.ip % 3);
            const homeERA = homePitcher.ip > 0 ? ((homePitcher.er * 27) / homePitcher.ip).toFixed(2) : '0.00';
            
            document.getElementById('homePitcherIP').textContent = homeIP;
            document.getElementById('homePitcherH').textContent = homePitcher.h;
            document.getElementById('homePitcherR').textContent = homePitcher.r;
            document.getElementById('homePitcherER').textContent = homePitcher.er;
            document.getElementById('homePitcherBB').textContent = homePitcher.bb;
            document.getElementById('homePitcherK').textContent = homePitcher.k;
            document.getElementById('homePitcherERA').textContent = homeERA;
        }

        function addToGameLog(text, category = 'Play') {
            const logEntry = document.createElement('div');
            logEntry.className = 'play-entry';
            logEntry.innerHTML = `
                <span><strong>${category}:</strong> ${text}</span>
                <small>${new Date().toLocaleTimeString()}</small>
            `;
            document.getElementById('gameLogEntries').appendChild(logEntry);
        }

        function startGame() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const homeLineupSize = parseInt(document.getElementById('homeLineupSize').value);
            const awayLineupSize = parseInt(document.getElementById('awayLineupSize').value);
            
            if (!homeTeam || !awayTeam) {
                alert('Please enter both team names');
                return;
            }
            
            // Initialize game state
            gameState.gameStarted = true;
            gameState.homeTeamName = homeTeam;
            gameState.awayTeamName = awayTeam;
            gameState.homeLineupSize = homeLineupSize;
            gameState.awayLineupSize = awayLineupSize;
            gameState.homeBatter = 1;
            gameState.awayBatter = 1;
            
            // Initialize player stats
            initializePlayerStats();
            
            // Update display
            document.getElementById('homeTeamName').textContent = homeTeam;
            document.getElementById('awayTeamName').textContent = awayTeam;
            document.getElementById('gameInterface').classList.remove('hidden');
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gameStatus').textContent = 'In Progress';
            document.getElementById('gameTitle').textContent = `${awayTeam} at ${homeTeam}`;
            
            // Update box score team names
            document.getElementById('awayTeamBatting').textContent = `${awayTeam} Batting`;
            document.getElementById('homeTeamBatting').textContent = `${homeTeam} Batting`;
            document.getElementById('awayTeamPitching').textContent = `${awayTeam} Pitching`;
            document.getElementById('homeTeamPitching').textContent = `${homeTeam} Pitching`;
            
            addToGameLog(`Game started: ${awayTeam} at ${homeTeam}`, 'Game');
            addToGameLog(`Away team batting order: ${awayLineupSize} players`, 'Setup');
            addToGameLog(`Home team batting order: ${homeLineupSize} players`, 'Setup');
            
            updateGameDisplay();
            updateBoxScore();
        }

        function submitPlay(managerNum) {
            console.log('submitPlay called for manager', managerNum);
            
            const result = document.getElementById(`m${managerNum}Result`).value;
            
            if (!result) {
                alert('Please select an at-bat result');
                return;
            }
            
            const submission = {
                result: result,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState[`manager${managerNum}Submission`] = submission;
            document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Submitted';
            document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-submitted';
            
            // Check if both managers have submitted
            if (gameState.manager1Submission && gameState.manager2Submission) {
                checkForConflicts();
            }
        }

        function checkForConflicts() {
            console.log('checkForConflicts started');
            
            const sub1 = gameState.manager1Submission;
            const sub2 = gameState.manager2Submission;
            
            // Check if submissions match
            const isConflict = sub1.result !== sub2.result;
            
            if (isConflict) {
                alert('Conflict detected! For now, using Manager 1 entry.');
                recordPlay(sub1);
            } else {
                console.log('No conflict, calling recordPlay');
                recordPlay(sub1);
            }
        }

        function calculateOuts(result) {
            // Double and Triple Plays
            if (result === 'DP4-6-3' || result === 'DP6-4-3' || result === 'DP5-4-3' || 
                result === 'DP1-6-3' || result === 'GDP') {
                return 2;
            }
            if (result === 'TP') {
                return 3;
            }
            
            // Single outs
            if (result === 'K' || result === 'KC' || // Strikeouts
                result.startsWith('F') || // Flyouts (F1-F9)
                result.startsWith('L') || // Lineouts (L1-L9)
                result.startsWith('P') || // Popouts (P1-P6)
                result === 'IF' || // Infield Fly
                result.includes('-') || // Ground outs (4-3, 6-3, etc.)
                result.endsWith('U') || // Unassisted outs (1U, 3U)
                result.startsWith('CS') || // Caught Stealing
                result.startsWith('PO') || // Picked Off
                result === 'OI' || // Offensive Interference
                result.startsWith('SF')) { // Sacrifice Fly
                return 1;
            }
            
            // Special strikeout situations that advance batter
            if (result === 'KPB' || result === 'KWP') {
                return 1; // Still an out, but batter may advance
            }
            
            return 0; // No outs for hits, walks, errors, etc.
        }

        function calculateRunnerMovement(result) {
            const currentBatterNum = getCurrentBatter();
            let newRunners = { first: null, second: null, third: null };
            let runsScored = 0;
            
            // Current runners
            const runnersToMove = {
                first: gameState.runners.first,
                second: gameState.runners.second,
                third: gameState.runners.third
            };
            
            // HITS
            if (result === 'HR') {
                // Home run - everyone scores
                runsScored = 1; // batter
                if (runnersToMove.first) runsScored++;
                if (runnersToMove.second) runsScored++;
                if (runnersToMove.third) runsScored++;
                // All bases empty after home run
            } else if (result === '3B') {
                // Triple - batter to third, all runners score
                newRunners.third = currentBatterNum;
                if (runnersToMove.first) runsScored++;
                if (runnersToMove.second) runsScored++;
                if (runnersToMove.third) runsScored++;
            } else if (result === '2B' || result === '2B+E') {
                // Double - batter to second, runners advance 2 bases
                newRunners.second = currentBatterNum;
                if (runnersToMove.first) runsScored++; // First to home
                if (runnersToMove.second) runsScored++; // Second to home
                if (runnersToMove.third) runsScored++; // Third to home
            } else if (result === '1B' || result === '1B+E') {
                // Single - batter to first
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Third scores on single
            
            // WALKS AND HBP
            } else if (result === 'BB' || result === 'IBB' || result === 'HBP' || result === 'CI') {
                // Walk/HBP - only force if needed
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) {
                    newRunners.second = runnersToMove.first;
                    if (runnersToMove.second) {
                        newRunners.third = runnersToMove.second;
                        if (runnersToMove.third) {
                            runsScored++; // Bases loaded walk
                        }
                    } else {
                        newRunners.third = runnersToMove.third;
                    }
                } else {
                    newRunners.second = runnersToMove.second;
                    newRunners.third = runnersToMove.third;
                }
            
            // ERRORS
            } else if (result.startsWith('E')) {
                // Error - batter reaches first, runners may advance
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Usually scores on error
            
            // FIELDER'S CHOICE
            } else if (result.startsWith('FC')) {
                // Fielder's choice - batter safe, usually a runner out
                newRunners.first = currentBatterNum;
                // Assume lead runner is out for simplicity
                if (runnersToMove.second) newRunners.second = runnersToMove.second;
                if (runnersToMove.third) newRunners.third = runnersToMove.third;
            
            // SACRIFICE PLAYS
            } else if (result.startsWith('SF')) {
                // Sacrifice fly - runner on third scores
                if (runnersToMove.third) runsScored++;
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
                // Third base runner scores, others stay
            } else if (result === 'SAC') {
                // Sacrifice bunt - runners advance
                if (runnersToMove.first && !runnersToMove.second) {
                    newRunners.second = runnersToMove.first;
                } else if (runnersToMove.first && runnersToMove.second) {
                    newRunners.second = runnersToMove.first;
                    newRunners.third = runnersToMove.second;
                }
                if (runnersToMove.third) newRunners.third = runnersToMove.third;
            
            // SPECIAL STRIKEOUTS
            } else if (result === 'KPB' || result === 'KWP') {
                // Strikeout but batter reaches on passed ball/wild pitch
                newRunners.first = currentBatterNum;
                newRunners.second = runnersToMove.first;
                newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Third may score
            
            // STOLEN BASES (non-batter events)
            } else if (result === 'SB2') {
                if (runnersToMove.first) {
                    newRunners.second = runnersToMove.first;
                    newRunners.first = null;
                }
                newRunners.third = runnersToMove.third;
            } else if (result === 'SB3') {
                if (runnersToMove.second) {
                    newRunners.third = runnersToMove.second;
                    newRunners.second = null;
                }
                newRunners.first = runnersToMove.first;
            } else if (result === 'SBH') {
                if (runnersToMove.third) runsScored++;
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
            
            // CAUGHT STEALING / PICKED OFF (runner out)
            } else if (result === 'CS2' || result === 'PO1') {
                // Runner on first is out
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
            } else if (result === 'CS3' || result === 'PO2') {
                // Runner on second is out
                newRunners.first = runnersToMove.first;
                newRunners.third = runnersToMove.third;
            } else if (result === 'CSH' || result === 'PO3') {
                // Runner on third is out
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
            
            // WILD PITCH / PASSED BALL (runners advance)
            } else if (result === 'WP' || result === 'PB') {
                newRunners.first = runnersToMove.first;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++;
            
            // BALK (all runners advance)
            } else if (result === 'BALK') {
                newRunners.first = runnersToMove.first;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++;
            
            // DOUBLE PLAYS
            } else if (result.startsWith('DP') || result === 'GDP') {
                // Ground into double play - batter out, lead runner out
                // Usually clears first base
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
            
            // TRIPLE PLAY
            } else if (result === 'TP') {
                // All runners out, bases empty
                // (bases already empty from outs calculation)
            
            // ALL OTHER OUTS (flyouts, groundouts, etc.)
            } else {
                // Regular outs - runners stay put unless special circumstances
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
                
                // On deep flyouts, runners may tag up and advance
                if (result.startsWith('F') && (result.includes('7') || result.includes('8') || result.includes('9'))) {
                    // Deep flyout to outfield - runner on third may score
                    if (runnersToMove.third && gameState.currentOuts < 2) {
                        runsScored++;
                        newRunners.third = null;
                    }
                }
            }
            
            return { runners: newRunners, runsScored: runsScored };
        }

        function recordPlay(play) {
            console.log('recordPlay started with:', play.result);
            
            gameState.totalPlays++;
            
            // Check for errors with 2 outs BEFORE processing the play
            const errorWith2OutsOccurred = checkForErrorWith2Outs(play.result);
            
            // Store current runners before the play
            const runnersBefore = {
                first: gameState.runners.first,
                second: gameState.runners.second,
                third: gameState.runners.third
            };
            
            // Calculate runner movement and scoring
            const result = calculateRunnerMovement(play.result);
            gameState.runners = result.runners;
            const runsScored = result.runsScored;
            
            // Calculate earned vs unearned runs using MLB rules
            const earnedRuns = calculateEarnedRuns(play.result, runsScored);
            const unearnedRuns = runsScored - earnedRuns;
            
            // Track who scored runs for individual stats
            const runnersWhoScored = [];
            if (runnersBefore.third && (result.runsScored > 0 || play.result.startsWith('SF'))) {
                runnersWhoScored.push(runnersBefore.third);
            }
            if (runnersBefore.second && ['HR', '3B', '2B'].includes(play.result)) {
                runnersWhoScored.push(runnersBefore.second);
            }
            if (runnersBefore.first && ['HR', '3B', '2B'].includes(play.result)) {
                runnersWhoScored.push(runnersBefore.first);
            }
            if (['HR', '3B', '2B', '1B'].includes(play.result) || play.result === '1B+E' || play.result === '2B+E') {
                runnersWhoScored.push(getCurrentBatter());
            }
            
            // Update runs scored for individual players
            runnersWhoScored.forEach(batterNum => {
                const team = gameState.isTopInning ? 'away' : 'home';
                if (gameState.playerStats[team][batterNum]) {
                    gameState.playerStats[team][batterNum].r++;
                }
            });
            
            // Update score
            if (gameState.isTopInning) {
                gameState.awayScore += runsScored;
            } else {
                gameState.homeScore += runsScored;
            }
            
            // Calculate outs and update innings pitched
            let outsAdded = calculateOuts(play.result);
            gameState.currentOuts += outsAdded;
            
            // Update pitcher innings pitched (in thirds of innings)
            const pitchingTeam = gameState.isTopInning ? 'home' : 'away';
            gameState.pitcherStats[pitchingTeam].ip += outsAdded;
            
            // Update player stats
            const currentBatterNum = getCurrentBatter();
            const isAway = gameState.isTopInning;
            const rbiCount = runsScored; // Simple RBI calculation
            
            // Only update stats for batter events (not stolen bases, etc.)
            const nonBatterEvents = ['SB2', 'SB3', 'SBH', 'CS2', 'CS3', 'CSH', 'PO1', 'PO2', 'PO3', 'WP', 'PB', 'BALK'];
            if (!nonBatterEvents.includes(play.result)) {
                updatePlayerStats(currentBatterNum, isAway, play.result, runsScored, rbiCount, earnedRuns);
            }
            
            // Create log message with earned run details
            let logMessage = `${getCurrentTeamName()} Batter #${getCurrentBatter()}: ${play.result}`;
            
            // Add runner information before play
            const runnerInfo = [];
            if (runnersBefore.first) runnerInfo.push(`1B: #${runnersBefore.first}`);
            if (runnersBefore.second) runnerInfo.push(`2B: #${runnersBefore.second}`);
            if (runnersBefore.third) runnerInfo.push(`3B: #${runnersBefore.third}`);
            
            if (runnerInfo.length > 0) {
                logMessage += ` (Runners: ${runnerInfo.join(', ')})`;
            }
            
            if (outsAdded > 0) {
                logMessage += ` | Out #${gameState.currentOuts}`;
            }
            
            if (runsScored > 0) {
                if (earnedRuns === runsScored) {
                    logMessage += ` | ${runsScored} RUN${runsScored > 1 ? 'S' : ''} SCORED (all earned)`;
                } else if (earnedRuns === 0) {
                    const reason = errorWith2OutsOccurred ? 'error with 2 outs' : 
                                  (play.result.startsWith('E') || play.result.includes('+E')) ? 'error' : 'passed ball';
                    logMessage += ` | ${runsScored} RUN${runsScored > 1 ? 'S' : ''} SCORED (all unearned - ${reason})`;
                } else {
                    logMessage += ` | ${runsScored} RUN${runsScored > 1 ? 'S' : ''} SCORED (${earnedRuns} earned, ${unearnedRuns} unearned)`;
                }
            }
            
            addToGameLog(logMessage, 'At-Bat');
            
            // Reset pitch count after completed at-bat
            resetPitchCount();
            
            // Advance batter (unless it's a non-batter event like stolen base)
            if (!nonBatterEvents.includes(play.result)) {
                advanceBatter();
            }
            
            // Check for inning change
            if (gameState.currentOuts >= 3) {
                // Reset error tracking at end of inning
                resetInningErrorTracking();
                
                // Clear bases at end of inning
                gameState.runners = { first: null, second: null, third: null };
                gameState.currentOuts = 0;
                if (gameState.isTopInning) {
                    gameState.isTopInning = false;
                    addToGameLog(`End of top ${gameState.currentInning}. Next batter: ${gameState.homeTeamName} #${gameState.homeBatter}`, 'Inning');
                } else {
                    gameState.isTopInning = true;
                    gameState.currentInning++;
                    addToGameLog(`End of bottom ${gameState.currentInning - 1}. Next batter: ${gameState.awayTeamName} #${gameState.awayBatter}`, 'Inning');
                }
            }
            
            resetForNextPlay();
            updateGameDisplay();
            updateBoxScore();
            
            console.log('recordPlay completed successfully');
        }

        function resetForNextPlay() {
            // Clear submissions
            gameState.manager1Submission = null;
            gameState.manager2Submission = null;
            
            // Reset form inputs
            document.getElementById('m1Result').value = '';
            document.getElementById('m2Result').value = '';
            
            // Reset status indicators
            document.getElementById('m1SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m1SubmissionStatus').className = 'status-indicator status-waiting';
            document.getElementById('m2SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m2SubmissionStatus').className = 'status-indicator status-waiting';
        }

        function clearInput(managerNum) {
            document.getElementById(`m${managerNum}Result`).value = '';
            if (gameState[`manager${managerNum}Submission`]) {
                gameState[`manager${managerNum}Submission`] = null;
                document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Waiting';
                document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-waiting';
            }
        }

        function updateGameDisplay() {
            const ordinals = ['th', 'st', 'nd', 'rd'];
            const ordinal = ordinals[gameState.currentInning % 10] || 'th';
            
            document.getElementById('inningDisplay').textContent = 
                `${gameState.isTopInning ? 'Top' : 'Bottom'} ${gameState.currentInning}${ordinal}`;
            document.getElementById('awayScore').textContent = gameState.awayScore;
            document.getElementById('homeScore').textContent = gameState.homeScore;
            document.getElementById('currentBatter').textContent = `#${getCurrentBatter()}`;
            document.getElementById('currentOuts').textContent = gameState.currentOuts;
            document.getElementById('teamBatting').textContent = getCurrentTeamName();
            
            updatePitchCount();
            updateRunnerDisplay();
        }

        function updateRunnerDisplay() {
            // Update base runner display with names and shading
            const firstBase = document.getElementById('firstBaseDiv');
            const secondBase = document.getElementById('secondBaseDiv');
            const thirdBase = document.getElementById('thirdBaseDiv');
            
            // First base
            if (gameState.runners.first) {
                document.getElementById('firstRunner').textContent = `#${gameState.runners.first}`;
                firstBase.style.background = '#90EE90';
                firstBase.style.borderColor = '#4CAF50';
                firstBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('firstRunner').textContent = 'Empty';
                firstBase.style.background = 'white';
                firstBase.style.borderColor = '#333';
                firstBase.style.boxShadow = 'none';
            }
            
            // Second base
            if (gameState.runners.second) {
                document.getElementById('secondRunner').textContent = `#${gameState.runners.second}`;
                secondBase.style.background = '#90EE90';
                secondBase.style.borderColor = '#4CAF50';
                secondBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('secondRunner').textContent = 'Empty';
                secondBase.style.background = 'white';
                secondBase.style.borderColor = '#333';
                secondBase.style.boxShadow = 'none';
            }
            
            // Third base
            if (gameState.runners.third) {
                document.getElementById('thirdRunner').textContent = `#${gameState.runners.third}`;
                thirdBase.style.background = '#90EE90';
                thirdBase.style.borderColor = '#4CAF50';
                thirdBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('thirdRunner').textContent = 'Empty';
                thirdBase.style.background = 'white';
                thirdBase.style.borderColor = '#333';
                thirdBase.style.boxShadow = 'none';
            }
            
            // Add hover effects for interactive bases
            [firstBase, secondBase, thirdBase].forEach(base => {
                base.addEventListener('mouseenter', function() {
                    this.style.transform = 'rotate(45deg) scale(1.1)';
                    this.style.borderColor = '#007bff';
                });
                
                base.addEventListener('mouseleave', function() {
                    this.style.transform = 'rotate(45deg) scale(1)';
                    if (this === firstBase && !gameState.runners.first) this.style.borderColor = '#333';
                    else if (this === secondBase && !gameState.runners.second) this.style.borderColor = '#333';
                    else if (this === thirdBase && !gameState.runners.third) this.style.borderColor = '#333';
                    else this.style.borderColor = '#4CAF50';
                });
            });
        }

        // Initialize display on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateGameDisplay();
            document.getElementById('gameSetup').classList.remove('hidden');
            document.getElementById('gameStatus').textContent = 'Ready to Setup';
        });
    </script>
</body>
</html>    <script>
        // Game State
        let gameState = {
            gameStarted: false,
            currentInning: 1,
            isTopInning: true,
            homeScore: 0,
            awayScore: 0,
            currentOuts: 0,
            // Batting order tracking
            homeBatter: 1,
            awayBatter: 1,
            homeLineupSize: 9,
            awayLineupSize: 9,
            homeTeamName: '',
            awayTeamName: '',
            runners: {
                first: null,
                second: null,
                third: null
            },
            manager1Submission: null,
            manager2Submission: null,
            totalPlays: 0,
            // Player Statistics
            playerStats: {
                home: {},
                away: {}
            },
            pitcherStats: {
                home: {
                    ip: 0,      // innings pitched (in thirds)
                    h: 0,       // hits allowed
                    r: 0,       // runs allowed
                    er: 0,      // earned runs allowed
                    bb: 0,      // walks allowed
                    k: 0        // strikeouts
                },
                away: {
                    ip: 0,
                    h: 0,
                    r: 0,
                    er: 0,
                    bb: 0,
                    k: 0
                }
            }
        };

        function getCurrentBatter() {
            return gameState.isTopInning ? gameState.awayBatter : gameState.homeBatter;
        }

        function getCurrentTeamName() {
            return gameState.isTopInning ? gameState.awayTeamName : gameState.homeTeamName;
        }

        function getCurrentLineupSize() {
            return gameState.isTopInning ? gameState.awayLineupSize : gameState.homeLineupSize;
        }

        function advanceBatter() {
            if (gameState.isTopInning) {
                gameState.awayBatter++;
                if (gameState.awayBatter > gameState.awayLineupSize) {
                    gameState.awayBatter = 1;
                }
            } else {
                gameState.homeBatter++;
                if (gameState.homeBatter > gameState.homeLineupSize) {
                    gameState.homeBatter = 1;
                }
            }
        }

        function initializePlayerStats() {
            // Initialize batting stats for both teams
            for (let i = 1; i <= gameState.awayLineupSize; i++) {
                gameState.playerStats.away[i] = {
                    ab: 0,      // at bats
                    r: 0,       // runs
                    h: 0,       // hits
                    rbi: 0,     // RBIs
                    bb: 0,      // walks
                    k: 0,       // strikeouts
                    avg: 0.000  // batting average
                };
            }
            
            for (let i = 1; i <= gameState.homeLineupSize; i++) {
                gameState.playerStats.home[i] = {
                    ab: 0,
                    r: 0,
                    h: 0,
                    rbi: 0,
                    bb: 0,
                    k: 0,
                    avg: 0.000
                };
            }
        }

        function updatePlayerStats(batterNum, isAway, result, runsScored, rbiCount) {
            const team = isAway ? 'away' : 'home';
            const pitcher = isAway ? 'home' : 'away'; // opposing pitcher
            const player = gameState.playerStats[team][batterNum];
            
            // Update batter stats
            if (isAtBat(result)) {
                player.ab++;
            }
            
            if (isHit(result)) {
                player.h++;
            }
            
            if (isWalk(result)) {
                player.bb++;
                gameState.pitcherStats[pitcher].bb++;
            }
            
            if (isStrikeout(result)) {
                player.k++;
                gameState.pitcherStats[pitcher].k++;
            }
            
            player.rbi += rbiCount;
            
            // Update batting average
            if (player.ab > 0) {
                player.avg = (player.h / player.ab).toFixed(3);
            }
            
            // Update pitcher stats
            if (isHit(result)) {
                gameState.pitcherStats[pitcher].h++;
            }
            
            gameState.pitcherStats[pitcher].r += runsScored;
            gameState.pitcherStats[pitcher].er += runsScored; // Assuming all earned for simplicity
        }

        function isAtBat(result) {
            // Count as at-bat (excludes walks, HBP, sacrifices)
            const nonAtBats = ['BB', 'IBB', 'HBP', 'CI', 'SAC', 'SF', 'SF7', 'SF8', 'SF9'];
            return !nonAtBats.includes(result) && !result.startsWith('SB') && !result.startsWith('CS') && !result.startsWith('PO') && result !== 'WP' && result !== 'PB' && result !== 'BALK';
        }

        function isHit(result) {
            return ['1B', '2B', '3B', 'HR', '1B+E', '2B+E'].includes(result);
        }

        function isWalk(result) {
            return ['BB', 'IBB', 'HBP', 'CI'].includes(result);
        }

        function isStrikeout(result) {
            return ['K', 'KC', 'KPB', 'KWP'].includes(result);
        }

        function showBoxScoreTab(tab) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Hide all content
            document.querySelectorAll('.box-score-content').forEach(content => content.classList.add('hidden'));
            
            // Show selected tab
            if (tab === 'batting') {
                document.querySelector('.tab-btn').classList.add('active');
                document.getElementById('battingStats').classList.remove('hidden');
            } else if (tab === 'pitching') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('pitchingStats').classList.remove('hidden');
            }
        }

        function updateBoxScore() {
            updateBattingStats();
            updatePitchingStats();
        }

        function updateBattingStats() {
            // Update away team batting
            const awayTable = document.getElementById('awayBattingStats');
            awayTable.innerHTML = '';
            
            for (let i = 1; i <= gameState.awayLineupSize; i++) {
                const stats = gameState.playerStats.away[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>Player ${i}</td>
                    <td>${stats.ab}</td>
                    <td>${stats.r}</td>
                    <td>${stats.h}</td>
                    <td>${stats.rbi}</td>
                    <td>${stats.bb}</td>
                    <td>${stats.k}</td>
                    <td>${stats.avg}</td>
                `;
                awayTable.appendChild(row);
            }
            
            // Update home team batting
            const homeTable = document.getElementById('homeBattingStats');
            homeTable.innerHTML = '';
            
            for (let i = 1; i <= gameState.homeLineupSize; i++) {
                const stats = gameState.playerStats.home[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td>Player ${i}</td>
                    <td>${stats.ab}</td>
                    <td>${stats.r}</td>
                    <td>${stats.h}</td>
                    <td>${stats.rbi}</td>
                    <td>${stats.bb}</td>
                    <td>${stats.k}</td>
                    <td>${stats.avg}</td>
                `;
                homeTable.appendChild(row);
            }
        }

        function updatePitchingStats() {
            // Update away team pitching (they pitch when home team bats)
            const awayPitcher = gameState.pitcherStats.away;
            const awayIP = Math.floor(awayPitcher.ip / 3) + '.' + (awayPitcher.ip % 3);
            const awayERA = awayPitcher.ip > 0 ? ((awayPitcher.er * 27) / awayPitcher.ip).toFixed(2) : '0.00';
            
            document.getElementById('awayPitcherIP').textContent = awayIP;
            document.getElementById('awayPitcherH').textContent = awayPitcher.h;
            document.getElementById('awayPitcherR').textContent = awayPitcher.r;
            document.getElementById('awayPitcherER').textContent = awayPitcher.er;
            document.getElementById('awayPitcherBB').textContent = awayPitcher.bb;
            document.getElementById('awayPitcherK').textContent = awayPitcher.k;
            document.getElementById('awayPitcherERA').textContent = awayERA;
            
            // Update home team pitching (they pitch when away team bats)
            const homePitcher = gameState.pitcherStats.home;
            const homeIP = Math.floor(homePitcher.ip / 3) + '.' + (homePitcher.ip % 3);
            const homeERA = homePitcher.ip > 0 ? ((homePitcher.er * 27) / homePitcher.ip).toFixed(2) : '0.00';
            
            document.getElementById('homePitcherIP').textContent = homeIP;
            document.getElementById('homePitcherH').textContent = homePitcher.h;
            document.getElementById('homePitcherR').textContent = homePitcher.r;
            document.getElementById('homePitcherER').textContent = homePitcher.er;
            document.getElementById('homePitcherBB').textContent = homePitcher.bb;
            document.getElementById('homePitcherK').textContent = homePitcher.k;
            document.getElementById('homePitcherERA').textContent = homeERA;
        }

        function addToGameLog(text, category = 'Play') {
            const logEntry = document.createElement('div');
            logEntry.className = 'play-entry';
            logEntry.innerHTML = `
                <span><strong>${category}:</strong> ${text}</span>
                <small>${new Date().toLocaleTimeString()}</small>
            `;
            document.getElementById('gameLogEntries').appendChild(logEntry);
        }

        function startGame() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const homeLineupSize = parseInt(document.getElementById('homeLineupSize').value);
            const awayLineupSize = parseInt(document.getElementById('awayLineupSize').value);
            
            if (!homeTeam || !awayTeam) {
                alert('Please enter both team names');
                return;
            }
            
            // Initialize game state
            gameState.gameStarted = true;
            gameState.homeTeamName = homeTeam;
            gameState.awayTeamName = awayTeam;
            gameState.homeLineupSize = homeLineupSize;
            gameState.awayLineupSize = awayLineupSize;
            gameState.homeBatter = 1;
            gameState.awayBatter = 1;
            
            // Initialize player stats
            initializePlayerStats();
            
            // Update display
            document.getElementById('homeTeamName').textContent = homeTeam;
            document.getElementById('awayTeamName').textContent = awayTeam;
            document.getElementById('gameInterface').classList.remove('hidden');
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gameStatus').textContent = 'In Progress';
            document.getElementById('gameTitle').textContent = `${awayTeam} at ${homeTeam}`;
            
            // Update box score team names
            document.getElementById('awayTeamBatting').textContent = `${awayTeam} Batting`;
            document.getElementById('homeTeamBatting').textContent = `${homeTeam} Batting`;
            document.getElementById('awayTeamPitching').textContent = `${awayTeam} Pitching`;
            document.getElementById('homeTeamPitching').textContent = `${homeTeam} Pitching`;
            
            addToGameLog(`Game started: ${awayTeam} at ${homeTeam}`, 'Game');
            addToGameLog(`Away team batting order: ${awayLineupSize} players`, 'Setup');
            addToGameLog(`Home team batting order: ${homeLineupSize} players`, 'Setup');
            
            updateGameDisplay();
            updateBoxScore();
        }

        function startGame() {
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const homeLineupSize = parseInt(document.getElementById('homeLineupSize').value);
            const awayLineupSize = parseInt(document.getElementById('awayLineupSize').value);
            
            if (!homeTeam || !awayTeam) {
                alert('Please enter both team names');
                return;
            }
            
            // Initialize game state
            gameState.gameStarted = true;
            gameState.homeTeamName = homeTeam;
            gameState.awayTeamName = awayTeam;
            gameState.homeLineupSize = homeLineupSize;
            gameState.awayLineupSize = awayLineupSize;
            gameState.homeBatter = 1;
            gameState.awayBatter = 1;
            
            // Initialize player stats
            initializePlayerStats();
            
            // Update display
            document.getElementById('homeTeamName').textContent = homeTeam;
            document.getElementById('awayTeamName').textContent = awayTeam;
            document.getElementById('gameInterface').classList.remove('hidden');
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gameStatus').textContent = 'In Progress';
            document.getElementById('gameTitle').textContent = `${awayTeam} at ${homeTeam}`;
            
            // Update box score team names
            document.getElementById('awayTeamBatting').textContent = `${awayTeam} Batting`;
            document.getElementById('homeTeamBatting').textContent = `${homeTeam} Batting`;
            document.getElementById('awayTeamPitching').textContent = `${awayTeam} Pitching`;
            document.getElementById('homeTeamPitching').textContent = `${homeTeam} Pitching`;
            
            addToGameLog(`Game started: ${awayTeam} at ${homeTeam}`, 'Game');
            addToGameLog(`Away team batting order: ${awayLineupSize} players`, 'Setup');
            addToGameLog(`Home team batting order: ${homeLineupSize} players`, 'Setup');
            
            updateGameDisplay();
            updateBoxScore();
        }

        function submitPlay(managerNum) {
            console.log('submitPlay called for manager', managerNum);
            
            const result = document.getElementById(`m${managerNum}Result`).value;
            
            if (!result) {
                alert('Please select an at-bat result');
                return;
            }
            
            const submission = {
                result: result,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState[`manager${managerNum}Submission`] = submission;
            document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Submitted';
            document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-submitted';
            
            // Check if both managers have submitted
            if (gameState.manager1Submission && gameState.manager2Submission) {
                checkForConflicts();
            }
        }

        function checkForConflicts() {
            console.log('checkForConflicts started');
            
            const sub1 = gameState.manager1Submission;
            const sub2 = gameState.manager2Submission;
            
            // Check if submissions match
            const isConflict = sub1.result !== sub2.result;
            
            if (isConflict) {
                alert('Conflict detected! For now, using Manager 1 entry.');
                recordPlay(sub1);
            } else {
                console.log('No conflict, calling recordPlay');
                recordPlay(sub1);
            }
        }

        function calculateOuts(result) {
            // Double and Triple Plays
            if (result === 'DP4-6-3' || result === 'DP6-4-3' || result === 'DP5-4-3' || 
                result === 'DP1-6-3' || result === 'GDP') {
                return 2;
            }
            if (result === 'TP') {
                return 3;
            }
            
            // Single outs
            if (result === 'K' || result === 'KC' || // Strikeouts
                result.startsWith('F') || // Flyouts (F1-F9)
                result.startsWith('L') || // Lineouts (L1-L9)
                result.startsWith('P') || // Popouts (P1-P6)
                result === 'IF' || // Infield Fly
                result.includes('-') || // Ground outs (4-3, 6-3, etc.)
                result.endsWith('U') || // Unassisted outs (1U, 3U)
                result.startsWith('CS') || // Caught Stealing
                result.startsWith('PO') || // Picked Off
                result === 'OI' || // Offensive Interference
                result.startsWith('SF')) { // Sacrifice Fly
                return 1;
            }
            
            // Special strikeout situations that advance batter
            if (result === 'KPB' || result === 'KWP') {
                return 1; // Still an out, but batter may advance
            }
            
            return 0; // No outs for hits, walks, errors, etc.
        }

        function calculateRunnerMovement(result) {
            const currentBatterNum = getCurrentBatter();
            let newRunners = { first: null, second: null, third: null };
            let runsScored = 0;
            
            // Current runners
            const runnersToMove = {
                first: gameState.runners.first,
                second: gameState.runners.second,
                third: gameState.runners.third
            };
            
            // HITS
            if (result === 'HR') {
                // Home run - everyone scores
                runsScored = 1; // batter
                if (runnersToMove.first) runsScored++;
                if (runnersToMove.second) runsScored++;
                if (runnersToMove.third) runsScored++;
                // All bases empty after home run
            } else if (result === '3B') {
                // Triple - batter to third, all runners score
                newRunners.third = currentBatterNum;
                if (runnersToMove.first) runsScored++;
                if (runnersToMove.second) runsScored++;
                if (runnersToMove.third) runsScored++;
            } else if (result === '2B' || result === '2B+E') {
                // Double - batter to second, runners advance 2 bases
                newRunners.second = currentBatterNum;
                if (runnersToMove.first) runsScored++; // First to home
                if (runnersToMove.second) runsScored++; // Second to home
                if (runnersToMove.third) runsScored++; // Third to home
            } else if (result === '1B' || result === '1B+E') {
                // Single - batter to first
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Third scores on single
            
            // WALKS AND HBP
            } else if (result === 'BB' || result === 'IBB' || result === 'HBP' || result === 'CI') {
                // Walk/HBP - only force if needed
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) {
                    newRunners.second = runnersToMove.first;
                    if (runnersToMove.second) {
                        newRunners.third = runnersToMove.second;
                        if (runnersToMove.third) {
                            runsScored++; // Bases loaded walk
                        }
                    } else {
                        newRunners.third = runnersToMove.third;
                    }
                } else {
                    newRunners.second = runnersToMove.second;
                    newRunners.third = runnersToMove.third;
                }
            
            // ERRORS
            } else if (result.startsWith('E')) {
                // Error - batter reaches first, runners may advance
                newRunners.first = currentBatterNum;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Usually scores on error
            
            // FIELDER'S CHOICE
            } else if (result.startsWith('FC')) {
                // Fielder's choice - batter safe, usually a runner out
                newRunners.first = currentBatterNum;
                // Assume lead runner is out for simplicity
                if (runnersToMove.second) newRunners.second = runnersToMove.second;
                if (runnersToMove.third) newRunners.third = runnersToMove.third;
            
            // SACRIFICE PLAYS
            } else if (result.startsWith('SF')) {
                // Sacrifice fly - runner on third scores
                if (runnersToMove.third) runsScored++;
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
                // Third base runner scores, others stay
            } else if (result === 'SAC') {
                // Sacrifice bunt - runners advance
                if (runnersToMove.first && !runnersToMove.second) {
                    newRunners.second = runnersToMove.first;
                } else if (runnersToMove.first && runnersToMove.second) {
                    newRunners.second = runnersToMove.first;
                    newRunners.third = runnersToMove.second;
                }
                if (runnersToMove.third) newRunners.third = runnersToMove.third;
            
            // SPECIAL STRIKEOUTS
            } else if (result === 'KPB' || result === 'KWP') {
                // Strikeout but batter reaches on passed ball/wild pitch
                newRunners.first = currentBatterNum;
                newRunners.second = runnersToMove.first;
                newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++; // Third may score
            
            // STOLEN BASES (non-batter events)
            } else if (result === 'SB2') {
                if (runnersToMove.first) {
                    newRunners.second = runnersToMove.first;
                    newRunners.first = null;
                }
                newRunners.third = runnersToMove.third;
            } else if (result === 'SB3') {
                if (runnersToMove.second) {
                    newRunners.third = runnersToMove.second;
                    newRunners.second = null;
                }
                newRunners.first = runnersToMove.first;
            } else if (result === 'SBH') {
                if (runnersToMove.third) runsScored++;
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
            
            // CAUGHT STEALING / PICKED OFF (runner out)
            } else if (result === 'CS2' || result === 'PO1') {
                // Runner on first is out
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
            } else if (result === 'CS3' || result === 'PO2') {
                // Runner on second is out
                newRunners.first = runnersToMove.first;
                newRunners.third = runnersToMove.third;
            } else if (result === 'CSH' || result === 'PO3') {
                // Runner on third is out
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
            
            // WILD PITCH / PASSED BALL (runners advance)
            } else if (result === 'WP' || result === 'PB') {
                newRunners.first = runnersToMove.first;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++;
            
            // BALK (all runners advance)
            } else if (result === 'BALK') {
                newRunners.first = runnersToMove.first;
                if (runnersToMove.first) newRunners.second = runnersToMove.first;
                if (runnersToMove.second) newRunners.third = runnersToMove.second;
                if (runnersToMove.third) runsScored++;
            
            // DOUBLE PLAYS
            } else if (result.startsWith('DP') || result === 'GDP') {
                // Ground into double play - batter out, lead runner out
                // Usually clears first base
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
            
            // TRIPLE PLAY
            } else if (result === 'TP') {
                // All runners out, bases empty
                // (bases already empty from outs calculation)
            
            // ALL OTHER OUTS (flyouts, groundouts, etc.)
            } else {
                // Regular outs - runners stay put unless special circumstances
                newRunners.first = runnersToMove.first;
                newRunners.second = runnersToMove.second;
                newRunners.third = runnersToMove.third;
                
                // On deep flyouts, runners may tag up and advance
                if (result.startsWith('F') && (result.includes('7') || result.includes('8') || result.includes('9'))) {
                    // Deep flyout to outfield - runner on third may score
                    if (runnersToMove.third && gameState.currentOuts < 2) {
                        runsScored++;
                        newRunners.third = null;
                    }
                }
            }
            
            return { runners: newRunners, runsScored: runsScored };
        }

        function recordPlay(play) {
            console.log('recordPlay started with:', play.result);
            
            gameState.totalPlays++;
            
            // Store current runners before the play
            const runnersBefore = {
                first: gameState.runners.first,
                second: gameState.runners.second,
                third: gameState.runners.third
            };
            
            // Calculate runner movement and scoring
            const result = calculateRunnerMovement(play.result);
            gameState.runners = result.runners;
            const runsScored = result.runsScored;
            
            // Track who scored runs for individual stats
            const runnersWhoScored = [];
            if (runnersBefore.third && (result.runsScored > 0 || play.result.startsWith('SF'))) {
                runnersWhoScored.push(runnersBefore.third);
            }
            if (runnersBefore.second && ['HR', '3B', '2B'].includes(play.result)) {
                runnersWhoScored.push(runnersBefore.second);
            }
            if (runnersBefore.first && ['HR', '3B', '2B'].includes(play.result)) {
                runnersWhoScored.push(runnersBefore.first);
            }
            if (['HR', '3B', '2B', '1B'].includes(play.result) || play.result === '1B+E' || play.result === '2B+E') {
                runnersWhoScored.push(getCurrentBatter());
            }
            
            // Update runs scored for individual players
            runnersWhoScored.forEach(batterNum => {
                const team = gameState.isTopInning ? 'away' : 'home';
                if (gameState.playerStats[team][batterNum]) {
                    gameState.playerStats[team][batterNum].r++;
                }
            });
            
            // Update score
            if (gameState.isTopInning) {
                gameState.awayScore += runsScored;
            } else {
                gameState.homeScore += runsScored;
            }
            
            // Calculate outs and update innings pitched
            let outsAdded = calculateOuts(play.result);
            gameState.currentOuts += outsAdded;
            
            // Update pitcher innings pitched (in thirds of innings)
            const pitchingTeam = gameState.isTopInning ? 'home' : 'away';
            gameState.pitcherStats[pitchingTeam].ip += outsAdded;
            
            // Update player stats
            const currentBatterNum = getCurrentBatter();
            const isAway = gameState.isTopInning;
            const rbiCount = runsScored; // Simple RBI calculation
            
            // Only update stats for batter events (not stolen bases, etc.)
            const nonBatterEvents = ['SB2', 'SB3', 'SBH', 'CS2', 'CS3', 'CSH', 'PO1', 'PO2', 'PO3', 'WP', 'PB', 'BALK'];
            if (!nonBatterEvents.includes(play.result)) {
                updatePlayerStats(currentBatterNum, isAway, play.result, runsScored, rbiCount);
            }
            
            // Create log message
            let logMessage = `${getCurrentTeamName()} Batter #${getCurrentBatter()}: ${play.result}`;
            
            // Add runner information before play
            const runnerInfo = [];
            if (runnersBefore.first) runnerInfo.push(`1B: #${runnersBefore.first}`);
            if (runnersBefore.second) runnerInfo.push(`2B: #${runnersBefore.second}`);
            if (runnersBefore.third) runnerInfo.push(`3B: #${runnersBefore.third}`);
            
            if (runnerInfo.length > 0) {
                logMessage += ` (Runners: ${runnerInfo.join(', ')})`;
            }
            
            if (outsAdded > 0) {
                logMessage += ` | Out #${gameState.currentOuts}`;
            }
            
            if (runsScored > 0) {
                logMessage += ` | ${runsScored} RUN${runsScored > 1 ? 'S' : ''} SCORED`;
            }
            
            addToGameLog(logMessage, 'At-Bat');
            
            // Advance batter (unless it's a non-batter event like stolen base)
            if (!nonBatterEvents.includes(play.result)) {
                advanceBatter();
            }
            
            // Check for inning change
            if (gameState.currentOuts >= 3) {
                // Clear bases at end of inning
                gameState.runners = { first: null, second: null, third: null };
                gameState.currentOuts = 0;
                if (gameState.isTopInning) {
                    gameState.isTopInning = false;
                    addToGameLog(`End of top ${gameState.currentInning}. Next batter: ${gameState.homeTeamName} #${gameState.homeBatter}`, 'Inning');
                } else {
                    gameState.isTopInning = true;
                    gameState.currentInning++;
                    addToGameLog(`End of bottom ${gameState.currentInning - 1}. Next batter: ${gameState.awayTeamName} #${gameState.awayBatter}`, 'Inning');
                }
            }
            
            resetForNextPlay();
            updateGameDisplay();
            updateBoxScore();
            
            console.log('recordPlay completed successfully');
        } += runsScored;
            } else {
                gameState.homeScore += runsScored;
            }
            
            // Calculate outs
            let outsAdded = calculateOuts(play.result);
            gameState.currentOuts += outsAdded;
            
            // Create log message
            let logMessage = `${getCurrentTeamName()} Batter #${getCurrentBatter()}: ${play.result}`;
            
            // Add runner information before play
            const runnerInfo = [];
            if (runnersBefore.first) runnerInfo.push(`1B: #${runnersBefore.first}`);
            if (runnersBefore.second) runnerInfo.push(`2B: #${runnersBefore.second}`);
            if (runnersBefore.third) runnerInfo.push(`3B: #${runnersBefore.third}`);
            
            if (runnerInfo.length > 0) {
                logMessage += ` (Runners: ${runnerInfo.join(', ')})`;
            }
            
            if (outsAdded > 0) {
                logMessage += ` | Out #${gameState.currentOuts}`;
            }
            
            if (runsScored > 0) {
                logMessage += ` | ${runsScored} RUN${runsScored > 1 ? 'S' : ''} SCORED`;
            }
            
            addToGameLog(logMessage, 'At-Bat');
            
            // Advance batter (unless it's a non-batter event like stolen base)
            const nonBatterEvents = ['SB2', 'SB3', 'SBH', 'CS2', 'CS3', 'CSH', 'PO1', 'PO2', 'PO3', 'WP', 'PB', 'BALK'];
            if (!nonBatterEvents.includes(play.result)) {
                advanceBatter();
            }
            
            // Check for inning change
            if (gameState.currentOuts >= 3) {
                // Clear bases at end of inning
                gameState.runners = { first: null, second: null, third: null };
                gameState.currentOuts = 0;
                if (gameState.isTopInning) {
                    gameState.isTopInning = false;
                    addToGameLog(`End of top ${gameState.currentInning}. Next batter: ${gameState.homeTeamName} #${gameState.homeBatter}`, 'Inning');
                } else {
                    gameState.isTopInning = true;
                    gameState.currentInning++;
                    addToGameLog(`End of bottom ${gameState.currentInning - 1}. Next batter: ${gameState.awayTeamName} #${gameState.awayBatter}`, 'Inning');
                }
            }
            
            resetForNextPlay();
            updateGameDisplay();
            
            console.log('recordPlay completed successfully');
        }

        function resetForNextPlay() {
            // Clear submissions
            gameState.manager1Submission = null;
            gameState.manager2Submission = null;
            
            // Reset form inputs
            document.getElementById('m1Result').value = '';
            document.getElementById('m2Result').value = '';
            
            // Reset status indicators
            document.getElementById('m1SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m1SubmissionStatus').className = 'status-indicator status-waiting';
            document.getElementById('m2SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m2SubmissionStatus').className = 'status-indicator status-waiting';
        }

        function clearInput(managerNum) {
            document.getElementById(`m${managerNum}Result`).value = '';
            if (gameState[`manager${managerNum}Submission`]) {
                gameState[`manager${managerNum}Submission`] = null;
                document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Waiting';
                document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-waiting';
            }
        }

        function updateGameDisplay() {
            const ordinals = ['th', 'st', 'nd', 'rd'];
            const ordinal = ordinals[gameState.currentInning % 10] || 'th';
            
            document.getElementById('inningDisplay').textContent = 
                `${gameState.isTopInning ? 'Top' : 'Bottom'} ${gameState.currentInning}${ordinal}`;
            document.getElementById('awayScore').textContent = gameState.awayScore;
            document.getElementById('homeScore').textContent = gameState.homeScore;
            document.getElementById('currentBatter').textContent = `#${getCurrentBatter()}`;
            document.getElementById('currentOuts').textContent = gameState.currentOuts;
            document.getElementById('teamBatting').textContent = getCurrentTeamName();
            
            updateRunnerDisplay();
        }

        function updateRunnerDisplay() {
            // Update base runner display with names and shading
            const firstBase = document.getElementById('firstBase').parentElement;
            const secondBase = document.getElementById('secondBase').parentElement;
            const thirdBase = document.getElementById('thirdBase').parentElement;
            
            // First base
            if (gameState.runners.first) {
                document.getElementById('firstRunner').textContent = `#${gameState.runners.first}`;
                firstBase.style.background = '#90EE90';
                firstBase.style.borderColor = '#4CAF50';
                firstBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('firstRunner').textContent = 'Empty';
                firstBase.style.background = 'white';
                firstBase.style.borderColor = '#333';
                firstBase.style.boxShadow = 'none';
            }
            
            // Second base
            if (gameState.runners.second) {
                document.getElementById('secondRunner').textContent = `#${gameState.runners.second}`;
                secondBase.style.background = '#90EE90';
                secondBase.style.borderColor = '#4CAF50';
                secondBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('secondRunner').textContent = 'Empty';
                secondBase.style.background = 'white';
                secondBase.style.borderColor = '#333';
                secondBase.style.boxShadow = 'none';
            }
            
            // Third base
            if (gameState.runners.third) {
                document.getElementById('thirdRunner').textContent = `#${gameState.runners.third}`;
                thirdBase.style.background = '#90EE90';
                thirdBase.style.borderColor = '#4CAF50';
                thirdBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('thirdRunner').textContent = 'Empty';
                thirdBase.style.background = 'white';
                thirdBase.style.borderColor = '#333';
                thirdBase.style.boxShadow = 'none';
            }
        }

        // Initialize display on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateGameDisplay();
            document.getElementById('gameSetup').classList.remove('hidden');
            document.getElementById('gameStatus').textContent = 'Ready to Setup';
        });

        function submitPlay(managerNum) {
            console.log('submitPlay called for manager', managerNum);
            
            const result = document.getElementById(`m${managerNum}Result`).value;
            
            if (!result) {
                alert('Please select an at-bat result');
                return;
            }
            
            const submission = {
                result: result,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState[`manager${managerNum}Submission`] = submission;
            document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Submitted';
            document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-submitted';
            
            // Check if both managers have submitted
            if (gameState.manager1Submission && gameState.manager2Submission) {
                checkForConflicts();
            }
        }

        function checkForConflicts() {
            console.log('checkForConflicts started');
            
            const sub1 = gameState.manager1Submission;
            const sub2 = gameState.manager2Submission;
            
            // Check if submissions match
            const isConflict = sub1.result !== sub2.result;
            
            if (isConflict) {
                alert('Conflict detected! For now, using Manager 1 entry.');
                recordPlay(sub1);
            } else {
                console.log('No conflict, calling recordPlay');
                recordPlay(sub1);
            }
        }

        function resetForNextPlay() {
            // Clear submissions
            gameState.manager1Submission = null;
            gameState.manager2Submission = null;
            
            // Reset form inputs
            document.getElementById('m1Result').value = '';
            document.getElementById('m2Result').value = '';
            
            // Reset status indicators
            document.getElementById('m1SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m1SubmissionStatus').className = 'status-indicator status-waiting';
            document.getElementById('m2SubmissionStatus').textContent = 'Waiting';
            document.getElementById('m2SubmissionStatus').className = 'status-indicator status-waiting';
        }

        function clearInput(managerNum) {
            document.getElementById(`m${managerNum}Result`).value = '';
            if (gameState[`manager${managerNum}Submission`]) {
                gameState[`manager${managerNum}Submission`] = null;
                document.getElementById(`m${managerNum}SubmissionStatus`).textContent = 'Waiting';
                document.getElementById(`m${managerNum}SubmissionStatus`).className = 'status-indicator status-waiting';
            }
        }

        function updateGameDisplay() {
            const ordinals = ['th', 'st', 'nd', 'rd'];
            const ordinal = ordinals[gameState.currentInning % 10] || 'th';
            
            document.getElementById('inningDisplay').textContent = 
                `${gameState.isTopInning ? 'Top' : 'Bottom'} ${gameState.currentInning}${ordinal}`;
            document.getElementById('awayScore').textContent = gameState.awayScore;
            document.getElementById('homeScore').textContent = gameState.homeScore;
            document.getElementById('currentBatter').textContent = `#${getCurrentBatter()}`;
            document.getElementById('currentOuts').textContent = gameState.currentOuts;
            document.getElementById('teamBatting').textContent = getCurrentTeamName();
            
            updateRunnerDisplay();
        }

        function updateRunnerDisplay() {
            // Update base runner display with names and shading
            const firstBase = document.getElementById('firstBase').parentElement;
            const secondBase = document.getElementById('secondBase').parentElement;
            const thirdBase = document.getElementById('thirdBase').parentElement;
            
            // First base
            if (gameState.runners.first) {
                document.getElementById('firstRunner').textContent = `#${gameState.runners.first}`;
                firstBase.style.background = '#90EE90';
                firstBase.style.borderColor = '#4CAF50';
                firstBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('firstRunner').textContent = 'Empty';
                firstBase.style.background = 'white';
                firstBase.style.borderColor = '#333';
                firstBase.style.boxShadow = 'none';
            }
            
            // Second base
            if (gameState.runners.second) {
                document.getElementById('secondRunner').textContent = `#${gameState.runners.second}`;
                secondBase.style.background = '#90EE90';
                secondBase.style.borderColor = '#4CAF50';
                secondBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('secondRunner').textContent = 'Empty';
                secondBase.style.background = 'white';
                secondBase.style.borderColor = '#333';
                secondBase.style.boxShadow = 'none';
            }
            
            // Third base
            if (gameState.runners.third) {
                document.getElementById('thirdRunner').textContent = `#${gameState.runners.third}`;
                thirdBase.style.background = '#90EE90';
                thirdBase.style.borderColor = '#4CAF50';
                thirdBase.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
            } else {
                document.getElementById('thirdRunner').textContent = 'Empty';
                thirdBase.style.background = 'white';
                thirdBase.style.borderColor = '#333';
                thirdBase.style.boxShadow = 'none';
            }
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseball Scorekeeping - Dual Manager System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c29 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .game-setup {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .manager-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .manager-panel {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 4px solid;
        }

        .manager-panel.manager1 {
            border-top-color: #007bff;
        }

        .manager-panel.manager2 {
            border-top-color: #dc3545;
        }

        .scoreboard {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-waiting {
            background: #ffc107;
            color: #333;
        }

        .status-submitted {
            background: #28a745;
            color: white;
        }

        .game-log {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .play-entry {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .play-entry:last-child {
            border-bottom: none;
        }

        .hidden {
            display: none;
        }

        .inning-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #2d5016;
            margin: 20px 0;
        }

        .score-display {
            display: flex;
            justify-content: center;
            gap: 40px;
            font-size: 18px;
            font-weight: bold;
        }

        .box-score {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .box-score-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #2d5016;
            border-bottom-color: #2d5016;
        }

        .tab-btn:hover {
            color: #2d5016;
        }

        .box-score-content {
            display: block;
        }

        .team-stats {
            margin-bottom: 30px;
        }

        .team-stats h4 {
            margin-bottom: 15px;
            color: #2d5016;
            font-size: 18px;
        }

        .stats-table-container {
            overflow-x: auto;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .stats-table th,
        .stats-table td {
            padding: 8px 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .stats-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }

        .stats-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .stats-table tbody tr:hover {
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>⚾ Baseball Scorekeeping System</h1>
            <p>Dual Manager System for Accurate Game Tracking</p>
            <div class="game-info">
                <div><strong>Game:</strong> <span id="gameTitle">Ready to Setup</span></div>
                <div><strong>Date:</strong> <span id="gameDate">July 4, 2025</span></div>
                <div><strong>Status:</strong> <span id="gameStatus">Setup</span></div>
            </div>
        </div>

        <!-- Game Setup -->
        <div id="gameSetup" class="game-setup">
            <h2>Game Setup</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3>Home Team</h3>
                    <input type="text" id="homeTeam" value="Red Sox" placeholder="Home team name">
                    <div style="margin-top: 15px;">
                        <label>Number of Players in Batting Order:</label>
                        <select id="homeLineupSize">
                            <option value="9">9 Players (Standard)</option>
                            <option value="10">10 Players (DH League)</option>
                            <option value="11">11 Players</option>
                            <option value="12">12 Players</option>
                            <option value="13">13 Players</option>
                            <option value="14">14 Players</option>
                            <option value="15">15 Players (Max)</option>
                        </select>
                    </div>
                </div>
                <div>
                    <h3>Away Team</h3>
                    <input type="text" id="awayTeam" value="Yankees" placeholder="Away team name">
                    <div style="margin-top: 15px;">
                        <label>Number of Players in Batting Order:</label>
                        <select id="awayLineupSize">
                            <option value="9">9 Players (Standard)</option>
                            <option value="10">10 Players (DH League)</option>
                            <option value="11">11 Players</option>
                            <option value="12">12 Players</option>
                            <option value="13">13 Players</option>
                            <option value="14">14 Players</option>
                            <option value="15">15 Players (Max)</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="btn btn-success" onclick="startGame()">Start Game</button>
        </div>

        <!-- Game Play Interface -->
        <div id="gameInterface" class="hidden">
            <!-- Current Game State -->
            <div class="scoreboard">
                <div class="inning-display">
                    <span id="inningDisplay">Top 1st</span>
                </div>
                <div class="score-display">
                    <div>
                        <span id="awayTeamName">Yankees</span>: <span id="awayScore">0</span>
                    </div>
                    <div>
                        <span id="homeTeamName">Red Sox</span>: <span id="homeScore">0</span>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <strong>Current Batter:</strong> <span id="currentBatter">#1</span> |
                    <strong>Outs:</strong> <span id="currentOuts">0</span> |
                    <strong>Team Batting:</strong> <span id="teamBatting">Away Team</span>
                </div>
                
                <!-- Pitch Count Display -->
                <div style="text-align: center; margin-top: 15px; padding: 15px; background: #e9ecef; border-radius: 5px;">
                    <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 10px;">
                        <div>
                            <strong>Balls:</strong> 
                            <span id="ballCount" style="font-size: 24px; font-weight: bold; color: #28a745;">0</span>
                        </div>
                        <div>
                            <strong>Strikes:</strong> 
                            <span id="strikeCount" style="font-size: 24px; font-weight: bold; color: #dc3545;">0</span>
                        </div>
                    </div>
                    <div>
                        <button class="btn" onclick="addBall()" style="margin: 0 5px;">Ball</button>
                        <button class="btn" onclick="addStrike()" style="margin: 0 5px;">Strike</button>
                        <button class="btn btn-warning" onclick="resetCount()" style="margin: 0 5px;">Reset Count</button>
                    </div>
                </div>
                
                <!-- Runner Display -->
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <h4 style="text-align: center; margin-bottom: 15px;">Base Runners (Click to Manage)</h4>
                    <div style="display: grid; place-items: center; gap: 15px;">
                        <!-- Top row: Second Base -->
                        <div style="text-align: center;">
                            <div id="secondBaseDiv" onclick="manageRunner('second')" style="width: 40px; height: 40px; border: 2px solid #333; transform: rotate(45deg); margin: 0 auto; display: flex; align-items: center; justify-content: center; background: white; cursor: pointer; transition: all 0.3s;">
                                <span id="secondBase" style="transform: rotate(-45deg); font-size: 12px; font-weight: bold;">2B</span>
                            </div>
                            <small id="secondRunner">Empty</small>
                        </div>
                        
                        <!-- Middle row: Third Base and First Base -->
                        <div style="display: flex; justify-content: center; gap: 80px;">
                            <div style="text-align: center;">
                                <div id="thirdBaseDiv" onclick="manageRunner('third')" style="width: 40px; height: 40px; border: 2px solid #333; transform: rotate(45deg); margin: 0 auto; display: flex; align-items: center; justify-content: center; background: white; cursor: pointer; transition: all 0.3s;">
                                    <span id="thirdBase" style="transform: rotate(-45deg); font-size: 12px; font-weight: bold;">3B</span>
                                </div>
                                <small id="thirdRunner">Empty</small>
                            </div>
                            <div style="text-align: center;">
                                <div id="firstBaseDiv" onclick="manageRunner('first')" style="width: 40px; height: 40px; border: 2px solid #333; transform: rotate(45deg); margin: 0 auto; display: flex; align-items: center; justify-content: center; background: white; cursor: pointer; transition: all 0.3s;">
                                    <span id="firstBase" style="transform: rotate(-45deg); font-size: 12px; font-weight: bold;">1B</span>
                                </div>
                                <small id="firstRunner">Empty</small>
                            </div>
                        </div>
                        
                        <!-- Bottom row: Home Plate -->
                        <div style="text-align: center;">
                            <div style="width: 40px; height: 40px; border: 2px solid #333; transform: rotate(45deg); margin: 0 auto; display: flex; align-items: center; justify-content: center; background: white;">
                                <span id="homeBase" style="transform: rotate(-45deg); font-size: 12px; font-weight: bold;">H</span>
                            </div>
                            <small>Home</small>
                        </div>
                    </div>
                </div>
                
                <!-- Runner Management Modal -->
                <div id="runnerModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); min-width: 400px;">
                        <h3 id="modalTitle">Manage Runner</h3>
                        <div id="modalContent">
                            <!-- Content populated by JavaScript -->
                        </div>
                        <div style="margin-top: 20px; text-align: center;">
                            <button class="btn btn-warning" onclick="closeRunnerModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manager Input Panels -->
            <div class="manager-panels">
                <div class="manager-panel manager1">
                    <h3>Manager 1 Input <span id="m1SubmissionStatus" class="status-indicator status-waiting">Waiting</span></h3>
                    <div class="form-group">
                        <label>At-Bat Result:</label>
                        <select id="m1Result">
                            <option value="">Select result...</option>
                            
                            <!-- HITS -->
                            <optgroup label="HITS">
                                <option value="1B">Single (1B)</option>
                                <option value="2B">Double (2B)</option>
                                <option value="3B">Triple (3B)</option>
                                <option value="HR">Home Run (HR)</option>
                                <option value="1B+E">Single + Error</option>
                                <option value="2B+E">Double + Error</option>
                            </optgroup>
                            
                            <!-- WALKS & HIT BY PITCH -->
                            <optgroup label="WALKS & HBP">
                                <option value="BB">Walk (BB)</option>
                                <option value="IBB">Intentional Walk (IBB)</option>
                                <option value="HBP">Hit By Pitch (HBP)</option>
                            </optgroup>
                            
                            <!-- STRIKEOUTS -->
                            <optgroup label="STRIKEOUTS">
                                <option value="K">Strikeout Swinging (K)</option>
                                <option value="KC">Strikeout Looking (KC)</option>
                                <option value="KPB">Strikeout + Passed Ball</option>
                                <option value="KWP">Strikeout + Wild Pitch</option>
                            </optgroup>
                            
                            <!-- GROUND OUTS -->
                            <optgroup label="GROUND OUTS">
                                <option value="1-3">Groundout P-1B (1-3)</option>
                                <option value="3-1">Groundout 3B-1B (3-1)</option>
                                <option value="4-3">Groundout SS-1B (4-3)</option>
                                <option value="5-3">Groundout 3B-1B (5-3)</option>
                                <option value="6-3">Groundout SS-1B (6-3)</option>
                                <option value="1U">Groundout P Unassisted (1U)</option>
                                <option value="3U">Groundout 1B Unassisted (3U)</option>
                            </optgroup>
                            
                            <!-- FLY OUTS -->
                            <optgroup label="FLY OUTS">
                                <option value="F1">Flyout to Pitcher (F1)</option>
                                <option value="F2">Flyout to Catcher (F2)</option>
                                <option value="F3">Flyout to 1B (F3)</option>
                                <option value="F4">Flyout to 2B (F4)</option>
                                <option value="F5">Flyout to 3B (F5)</option>
                                <option value="F6">Flyout to SS (F6)</option>
                                <option value="F7">Flyout to LF (F7)</option>
                                <option value="F8">Flyout to CF (F8)</option>
                                <option value="F9">Flyout to RF (F9)</option>
                            </optgroup>
                            
                            <!-- LINE OUTS -->
                            <optgroup label="LINE OUTS">
                                <option value="L1">Lineout to Pitcher (L1)</option>
                                <option value="L3">Lineout to 1B (L3)</option>
                                <option value="L4">Lineout to 2B (L4)</option>
                                <option value="L5">Lineout to 3B (L5)</option>
                                <option value="L6">Lineout to SS (L6)</option>
                                <option value="L7">Lineout to LF (L7)</option>
                                <option value="L8">Lineout to CF (L8)</option>
                                <option value="L9">Lineout to RF (L9)</option>
                            </optgroup>
                            
                            <!-- POP OUTS -->
                            <optgroup label="POP OUTS">
                                <option value="P1">Popout to Pitcher (P1)</option>
                                <option value="P2">Popout to Catcher (P2)</option>
                                <option value="P3">Popout to 1B (P3)</option>
                                <option value="P4">Popout to 2B (P4)</option>
                                <option value="P5">Popout to 3B (P5)</option>
                                <option value="P6">Popout to SS (P6)</option>
                                <option value="IF">Infield Fly (IF)</option>
                            </optgroup>
                            
                            <!-- DOUBLE PLAYS -->
                            <optgroup label="DOUBLE PLAYS">
                                <option value="DP4-6-3">DP 2B-SS-1B (4-6-3)</option>
                                <option value="DP6-4-3">DP SS-2B-1B (6-4-3)</option>
                                <option value="DP5-4-3">DP 3B-2B-1B (5-4-3)</option>
                                <option value="DP1-6-3">DP P-SS-1B (1-6-3)</option>
                                <option value="GDP">Ground into Double Play</option>
                            </optgroup>
                            
                            <!-- TRIPLE PLAYS -->
                            <optgroup label="TRIPLE PLAYS">
                                <option value="TP">Triple Play</option>
                            </optgroup>
                            
                            <!-- ERRORS -->
                            <optgroup label="ERRORS">
                                <option value="E1">Error on Pitcher (E1)</option>
                                <option value="E2">Error on Catcher (E2)</option>
                                <option value="E3">Error on 1B (E3)</option>
                                <option value="E4">Error on 2B (E4)</option>
                                <option value="E5">Error on 3B (E5)</option>
                                <option value="E6">Error on SS (E6)</option>
                                <option value="E7">Error on LF (E7)</option>
                                <option value="E8">Error on CF (E8)</option>
                                <option value="E9">Error on RF (E9)</option>
                            </optgroup>
                            
                            <!-- FIELDER'S CHOICE -->
                            <optgroup label="FIELDER'S CHOICE">
                                <option value="FC">Fielder's Choice (FC)</option>
                                <option value="FC4">Fielder's Choice 2B (FC4)</option>
                                <option value="FC5">Fielder's Choice 3B (FC5)</option>
                                <option value="FC6">Fielder's Choice SS (FC6)</option>
                            </optgroup>
                            
                            <!-- SACRIFICE -->
                            <optgroup label="SACRIFICE">
                                <option value="SAC">Sacrifice Bunt (SAC)</option>
                                <option value="SF">Sacrifice Fly (SF)</option>
                                <option value="SF7">Sacrifice Fly LF (SF7)</option>
                                <option value="SF8">Sacrifice Fly CF (SF8)</option>
                                <option value="SF9">Sacrifice Fly RF (SF9)</option>
                            </optgroup>
                            
                            <!-- INTERFERENCE -->
                            <optgroup label="INTERFERENCE">
                                <option value="CI">Catcher Interference (CI)</option>
                                <option value="OI">Offensive Interference (OI)</option>
                                <option value="FI">Fan Interference (FI)</option>
                            </optgroup>
                            
                            <!-- SPECIAL SITUATIONS -->
                            <optgroup label="SPECIAL SITUATIONS">
                                <option value="BALK">Balk</option>
                                <option value="WP">Wild Pitch</option>
                                <option value="PB">Passed Ball</option>
                                <option value="SB2">Stolen Base 2nd</option>
                                <option value="SB3">Stolen Base 3rd</option>
                                <option value="SBH">Stolen Base Home</option>
                                <option value="CS2">Caught Stealing 2nd</option>
                                <option value="CS3">Caught Stealing 3rd</option>
                                <option value="CSH">Caught Stealing Home</option>
                                <option value="PO1">Picked Off 1st</option>
                                <option value="PO2">Picked Off 2nd</option>
                                <option value="PO3">Picked Off 3rd</option>
                            </optgroup>
                        </select>
                    </div>
                    <button class="btn" onclick="submitPlay(1)">Submit Play</button>
                    <button class="btn btn-warning" onclick="clearInput(1)">Clear</button>
                </div>

                <div class="manager-panel manager2">
                    <h3>Manager 2 Input <span id="m2SubmissionStatus" class="status-indicator status-waiting">Waiting</span></h3>
                    <div class="form-group">
                        <label>At-Bat Result:</label>
                        <select id="m2Result">
                            <option value="">Select result...</option>
                            
                            <!-- HITS -->
                            <optgroup label="HITS">
                                <option value="1B">Single (1B)</option>
                                <option value="2B">Double (2B)</option>
                                <option value="3B">Triple (3B)</option>
                                <option value="HR">Home Run (HR)</option>
                                <option value="1B+E">Single + Error</option>
                                <option value="2B+E">Double + Error</option>
                            </optgroup>
                            
                            <!-- WALKS & HIT BY PITCH -->
                            <optgroup label="WALKS & HBP">
                                <option value="BB">Walk (BB)</option>
                                <option value="IBB">Intentional Walk (IBB)</option>
                                <option value="HBP">Hit By Pitch (HBP)</option>
                            </optgroup>
                            
                            <!-- STRIKEOUTS -->
                            <optgroup label="STRIKEOUTS">
                                <option value="K">Strikeout Swinging (K)</option>
                                <option value="KC">Strikeout Looking (KC)</option>
                                <option value="KPB">Strikeout + Passed Ball</option>
                                <option value="KWP">Strikeout + Wild Pitch</option>
                            </optgroup>
                            
                            <!-- GROUND OUTS -->
                            <optgroup label="GROUND OUTS">
                                <option value="1-3">Groundout P-1B (1-3)</option>
                                <option value="3-1">Groundout 3B-1B (3-1)</option>
                                <option value="4-3">Groundout SS-1B (4-3)</option>
                                <option value="5-3">Groundout 3B-1B (5-3)</option>
                                <option value="6-3">Groundout SS-1B (6-3)</option>
                                <option value="1U">Groundout P Unassisted (1U)</option>
                                <option value="3U">Groundout 1B Unassisted (3U)</option>
                            </optgroup>
                            
                            <!-- FLY OUTS -->
                            <optgroup label="FLY OUTS">
                                <option value="F1">Flyout to Pitcher (F1)</option>
                                <option value="F2">Flyout to Catcher (F2)</option>
                                <option value="F3">Flyout to 1B (F3)</option>
                                <option value="F4">Flyout to 2B (F4)</option>
                                <option value="F5">Flyout to 3B (F5)</option>
                                <option value="F6">Flyout to SS (F6)</option>
                                <option value="F7">Flyout to LF (F7)</option>
                                <option value="F8">Flyout to CF (F8)</option>
                                <option value="F9">Flyout to RF (F9)</option>
                            </optgroup>
                            
                            <!-- LINE OUTS -->
                            <optgroup label="LINE OUTS">
                                <option value="L1">Lineout to Pitcher (L1)</option>
                                <option value="L3">Lineout to 1B (L3)</option>
                                <option value="L4">Lineout to 2B (L4)</option>
                                <option value="L5">Lineout to 3B (L5)</option>
                                <option value="L6">Lineout to SS (L6)</option>
                                <option value="L7">Lineout to LF (L7)</option>
                                <option value="L8">Lineout to CF (L8)</option>
                                <option value="L9">Lineout to RF (L9)</option>
                            </optgroup>
                            
                            <!-- POP OUTS -->
                            <optgroup label="POP OUTS">
                                <option value="P1">Popout to Pitcher (P1)</option>
                                <option value="P2">Popout to Catcher (P2)</option>
                                <option value="P3">Popout to 1B (P3)</option>
                                <option value="P4">Popout to 2B (P4)</option>
                                <option value="P5">Popout to 3B (P5)</option>
                                <option value="P6">Popout to SS (P6)</option>
                                <option value="IF">Infield Fly (IF)</option>
                            </optgroup>
                            
                            <!-- DOUBLE PLAYS -->
                            <optgroup label="DOUBLE PLAYS">
                                <option value="DP4-6-3">DP 2B-SS-1B (4-6-3)</option>
                                <option value="DP6-4-3">DP SS-2B-1B (6-4-3)</option>
                                <option value="DP5-4-3">DP 3B-2B-1B (5-4-3)</option>
                                <option value="DP1-6-3">DP P-SS-1B (1-6-3)</option>
                                <option value="GDP">Ground into Double Play</option>
                            </optgroup>
                            
                            <!-- TRIPLE PLAYS -->
                            <optgroup label="TRIPLE PLAYS">
                                <option value="TP">Triple Play</option>
                            </optgroup>
                            
                            <!-- ERRORS -->
                            <optgroup label="ERRORS">
                                <option value="E1">Error on Pitcher (E1)</option>
                                <option value="E2">Error on Catcher (E2)</option>
                                <option value="E3">Error on 1B (E3)</option>
                                <option value="E4">Error on 2B (E4)</option>
                                <option value="E5">Error on 3B (E5)</option>
                                <option value="E6">Error on SS (E6)</option>
                                <option value="E7">Error on LF (E7)</option>
                                <option value="E8">Error on CF (E8)</option>
                                <option value="E9">Error on RF (E9)</option>
                            </optgroup>
                            
                            <!-- FIELDER'S CHOICE -->
                            <optgroup label="FIELDER'S CHOICE">
                                <option value="FC">Fielder's Choice (FC)</option>
                                <option value="FC4">Fielder's Choice 2B (FC4)</option>
                                <option value="FC5">Fielder's Choice 3B (FC5)</option>
                                <option value="FC6">Fielder's Choice SS (FC6)</option>
                            </optgroup>
                            
                            <!-- SACRIFICE -->
                            <optgroup label="SACRIFICE">
                                <option value="SAC">Sacrifice Bunt (SAC)</option>
                                <option value="SF">Sacrifice Fly (SF)</option>
                                <option value="SF7">Sacrifice Fly LF (SF7)</option>
                                <option value="SF8">Sacrifice Fly CF (SF8)</option>
                                <option value="SF9">Sacrifice Fly RF (SF9)</option>
                            </optgroup>
                            
                            <!-- INTERFERENCE -->
                            <optgroup label="INTERFERENCE">
                                <option value="CI">Catcher Interference (CI)</option>
                                <option value="OI">Offensive Interference (OI)</option>
                                <option value="FI">Fan Interference (FI)</option>
                            </optgroup>
                            
                            <!-- SPECIAL SITUATIONS -->
                            <optgroup label="SPECIAL SITUATIONS">
                                <option value="BALK">Balk</option>
                                <option value="WP">Wild Pitch</option>
                                <option value="PB">Passed Ball</option>
                                <option value="SB2">Stolen Base 2nd</option>
                                <option value="SB3">Stolen Base 3rd</option>
                                <option value="SBH">Stolen Base Home</option>
                                <option value="CS2">Caught Stealing 2nd</option>
                                <option value="CS3">Caught Stealing 3rd</option>
                                <option value="CSH">Caught Stealing Home</option>
                                <option value="PO1">Picked Off 1st</option>
                                <option value="PO2">Picked Off 2nd</option>
                                <option value="PO3">Picked Off 3rd</option>
                            </optgroup>
                        </select>
                    </div>
                    <button class="btn" onclick="submitPlay(2)">Submit Play</button>
                    <button class="btn btn-warning" onclick="clearInput(2)">Clear</button>
                </div>
            </div>

            <!-- Box Score -->
            <div class="box-score">
                <h3>📊 Box Score</h3>
                <div class="box-score-tabs">
                    <button class="tab-btn active" onclick="showBoxScoreTab('batting')">Batting</button>
                    <button class="tab-btn" onclick="showBoxScoreTab('pitching')">Pitching</button>
                </div>
                
                <!-- Batting Stats -->
                <div id="battingStats" class="box-score-content">
                    <div class="team-stats">
                        <h4 id="awayTeamBatting">Yankees Batting</h4>
                        <div class="stats-table-container">
                            <table class="stats-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Player</th>
                                        <th>AB</th>
                                        <th>R</th>
                                        <th>H</th>
                                        <th>RBI</th>
                                        <th>BB</th>
                                        <th>K</th>
                                        <th>AVG</th>
                                    </tr>
                                </thead>
                                <tbody id="awayBattingStats">
                                    <!-- Batting stats will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="team-stats">
                        <h4 id="homeTeamBatting">Red Sox Batting</h4>
                        <div class="stats-table-container">
                            <table class="stats-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Player</th>
                                        <th>AB</th>
                                        <th>R</th>
                                        <th>H</th>
                                        <th>RBI</th>
                                        <th>BB</th>
                                        <th>K</th>
                                        <th>AVG</th>
                                    </tr>
                                </thead>
                                <tbody id="homeBattingStats">
                                    <!-- Batting stats will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Pitching Stats -->
                <div id="pitchingStats" class="box-score-content hidden">
                    <div class="team-stats">
                        <h4 id="awayTeamPitching">Yankees Pitching</h4>
                        <div class="stats-table-container">
                            <table class="stats-table">
                                <thead>
                                    <tr>
                                        <th>Pitcher</th>
                                        <th>IP</th>
                                        <th>H</th>
                                        <th>R</th>
                                        <th>ER</th>
                                        <th>BB</th>
                                        <th>K</th>
                                        <th>ERA</th>
                                    </tr>
                                </thead>
                                <tbody id="awayPitchingStats">
                                    <tr>
                                        <td>Starter</td>
                                        <td id="awayPitcherIP">0.0</td>
                                        <td id="awayPitcherH">0</td>
                                        <td id="awayPitcherR">0</td>
                                        <td id="awayPitcherER">0</td>
                                        <td id="awayPitcherBB">0</td>
                                        <td id="awayPitcherK">0</td>
                                        <td id="awayPitcherERA">0.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="team-stats">
                        <h4 id="homeTeamPitching">Red Sox Pitching</h4>
                        <div class="stats-table-container">
                            <table class="stats-table">
                                <thead>
                                    <tr>
                                        <th>Pitcher</th>
                                        <th>IP</th>
                                        <th>H</th>
                                        <th>R</th>
                                        <th>ER</th>
                                        <th>BB</th>
                                        <th>K</th>
                                        <th>ERA</th>
                                    </tr>
                                </thead>
                                <tbody id="homePitchingStats">
                                    <tr>
                                        <td>Starter</td>
                                        <td id="homePitcherIP">0.0</td>
                                        <td id="homePitcherH">0</td>
                                        <td id="homePitcherR">0</td>
                                        <td id="homePitcherER">0</td>
                                        <td id="homePitcherBB">0</td>
                                        <td id="homePitcherK">0</td>
                                        <td id="homePitcherERA">0.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Log -->
            <div class="game-log">
                <h3>Game Log</h3>
                <div id="gameLogEntries">
                    <div class="play-entry">
                        <span>Game ready to start</span>
                        <small>Click "Start Game" to begin</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            gameStarted: false,
            currentInning: 1,
            isTopInning: true,
            homeScore: 0,
            awayScore: